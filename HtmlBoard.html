<!DOCTYPE html>
    <html>
		<head>
			<style>
				#mainChessBoard
				{
					width:800px;
					height:800px;
					border:1px solid black;
				}
				
				#logs
				{
					width:800px;
					height:400px;
					border:1px solid black;
					font-size:30px;
					overflow: auto;
				}

				.cell
				{
					width:100px;
					height:100px;
					float:left;
				}

			</style>
			<script type="text/javascript" src="jquery-1.12.1.min.js"></script>
		</head>
			<body>
				<div id="mainChessBoard"></div>
				<div id="logs"></div>
				<script type="text/javascript">
					function insertimage(color, imagepath, figuretype, colorside, column, row, additional)
					{
						var cell = document.createElement("div");
						cell.className='cell';
						cell.style.backgroundColor = color;
						cell.setAttribute('figuretype', figuretype);
						cell.setAttribute('colorside', colorside);
						cell.setAttribute('row', row);
						cell.setAttribute('column', column);
						if(additional != 'nothing')cell.setAttribute('additional', additional);
						if (imagepath != null)
						{
							var img = document.createElement("img");
							img.src = imagepath;
							document.getElementById("mainChessBoard").appendChild(cell).appendChild(img);
						}
						else
							document.getElementById("mainChessBoard").appendChild(cell);
					}	
					
					function finddiv (x, y) 
					{
						return $(".cell[column=" + x + "][row=" + y + "]");
					}
					
					function finddivImg (x, y)
					{
						return $(".cell[column=" + x + "][row=" + y + "] img");
					}
					
					function charasciidifference(char1, char2)
					{
						return Math.abs(char1.charCodeAt(0) - char2.charCodeAt(0));
					}
					
					function rowdifference(div1, div2)
					{
						return Math.abs(div1.getAttribute('row') - div2.getAttribute('row'));
					}
					
					function columndifference(div1, div2)
					{
						return Math.abs(div1.getAttribute('column').charCodeAt(0) - div2.getAttribute('column').charCodeAt(0));
					}
					
					function addToLogNewLine(str)
					{
						$("#logs").html($('#logs').html() + "<br>" + str);
					}
					
					function addToLog(str)
					{
						$("#logs").html($('#logs').html() + str);
					}
					
					function sign(x) { return x > 0 ? 1 : x < 0 ? -1 : 0; }
					
					function isanyonebetween(touchedfigure, destination)
					{
						var x=touchedfigure.getAttribute('column').charCodeAt(0);
						var x1=destination.getAttribute('column').charCodeAt(0);
						var y=touchedfigure.getAttribute('row');
						var y1=destination.getAttribute('row');
						var X=0;
						var Y=0;
						for (i=1; i <= (x1-x === 0? Math.abs(y1-y) :  Math.abs(x1-x)) - 1; i++)
						{
							X = sign(x1-x)*i;
							Y = sign(y1-y)*i;
							if (finddiv(String.fromCharCode(x + X) , (+y + Y)).attr('figuretype') != 'nothing') return false;
							if (finddiv(String.fromCharCode(x + X) , (+y + Y)).attr('figuretype') != 'nothing') return false;
						}
						return true;
					}
					
					var roquemode = false;
					function readytoroque(king, destination)
					{
						var rook = finddiv(king.getAttribute('column').charCodeAt(0) > destination.getAttribute('column').charCodeAt(0)? 'a' : 'h', king.getAttribute('row'));
						if (king.getAttribute("additional") === 'not moving' &&
							rook.attr('figuretype') === 'rook' &&
							rook.attr('colorside') === king.getAttribute('colorside') &&
							rook.attr('additional') === 'not moving' &&
							isanyonebetween(king, rook[0]))
							{
								roquemode=true;
								return true;
							}
						else return false;
					}
					
					function move(touchedfigure, destination)
					{
						if (destination.getAttribute('figuretype')==='nothing')
						{
							var img = document.createElement("img");
							img.src = touchedfigure.getElementsByTagName("img")[0].src;
							destination.appendChild(img);
						}
						else
						{
							destination.getElementsByTagName("img")[0].src = touchedfigure.getElementsByTagName("img")[0].src;
						}
						destination.setAttribute('colorside', touchedfigure.getAttribute('colorside'));
						destination.setAttribute('figuretype', touchedfigure.getAttribute('figuretype'));
						finddiv(touchedfigure.getAttribute('column'), touchedfigure.getAttribute('row')).attr('colorside', 'nothing');
						finddiv(touchedfigure.getAttribute('column'), touchedfigure.getAttribute('row')).attr('figuretype', 'nothing');
						finddiv(touchedfigure.getAttribute('column'), touchedfigure.getAttribute('row')).attr('additional', 'moved');
						finddivImg(touchedfigure.getAttribute('column'), touchedfigure.getAttribute('row')).remove();
						destination.setAttribute('additional', 'moved')	;
					}
					
					function ismovecorrect(touchedfigure, destination)
					{
						switch(touchedfigure.getAttribute('figuretype'))
						{
							case 'knight':
								return ((rowdifference(touchedfigure, destination) === 2 && columndifference(touchedfigure, destination) === 1) ||
									(rowdifference(touchedfigure, destination) === 1 && columndifference(touchedfigure, destination) === 2)) &&
									(touchedfigure.getAttribute('colorside')!=destination.getAttribute('colorside'));
							case 'rook':
								return (touchedfigure.getAttribute('row') === destination.getAttribute('row') ||
										touchedfigure.getAttribute('column') === destination.getAttribute('column')) &&
										isanyonebetween(touchedfigure, destination) && (touchedfigure.getAttribute('colorside')!=destination.getAttribute('colorside'));
							case 'bishop':
								return (rowdifference(touchedfigure, destination) === columndifference(touchedfigure, destination)) &&
										isanyonebetween(touchedfigure, destination) && (touchedfigure.getAttribute('colorside')!=destination.getAttribute('colorside'));
							case 'pawn':
								return (((destination.getAttribute('row') - touchedfigure.getAttribute('row') === (touchedfigure.getAttribute('colorside') === 'white'? 1 : -1 )) &&
									(touchedfigure.getAttribute('column') === destination.getAttribute('column') && (destination.getAttribute('figuretype') === 'nothing')  || 
									(columndifference(touchedfigure, destination) === 1  && (destination.getAttribute('figuretype') != 'nothing')
									&& (destination.getAttribute('colorside') != touchedfigure.getAttribute('colorside'))))) ||
									
									(destination.getAttribute('row') - touchedfigure.getAttribute('row') === (touchedfigure.getAttribute('colorside') === 'white'? 2 : -2 ) &&
									touchedfigure.getAttribute('column') === destination.getAttribute('column') && 
									destination.getAttribute('figuretype') === 'nothing' && 
									(touchedfigure.hasAttribute('additional') && touchedfigure.getAttribute('additional') === 'not moving') &&
									isanyonebetween(touchedfigure, destination))) && (touchedfigure.getAttribute('colorside')!=destination.getAttribute('colorside'));
							case 'king': 
								return (((rowdifference(touchedfigure, destination) === 0 || rowdifference(touchedfigure, destination) === 1) &&
										(columndifference(touchedfigure, destination) === 0 || columndifference(touchedfigure,destination) === 1)) ||
										(columndifference(touchedfigure, destination) === 2 && rowdifference(touchedfigure, destination) === 0 && readytoroque(touchedfigure, destination))) &&
										(touchedfigure.getAttribute('colorside')!=destination.getAttribute('colorside'));
							case 'queen':
								return (touchedfigure.getAttribute('row') === destination.getAttribute('row') ||
										touchedfigure.getAttribute('column') === destination.getAttribute('column') ||
										rowdifference(touchedfigure, destination) === columndifference(touchedfigure, destination)) &&
										isanyonebetween(touchedfigure, destination) && (touchedfigure.getAttribute('colorside')!=destination.getAttribute('colorside'));
 							default:
								return true;
						}
					}
					
					
					
					function check(attackingcolor)
					{
						var attackers = $(".cell[colorside=" + attackingcolor + "]");
						var defencingcolor = (attackingcolor === 'white'? 'black' : 'white');
						var threat = false;
						attackers.each(function(){
							if (ismovecorrect(this, $(".cell[colorside=" + defencingcolor + "][figuretype='king']")[0])) 
							{
								threat = true;
								return;
							}
						});
						return threat;
					}

					var devoured = document.createElement("div");
					devoured.appendChild(document.createElement("img"));
					function isSimulatedMoveThreatening(touchedfigure, destination)
					{
						var attackingcolor = touchedfigure.getAttribute('colorside') === 'white'? "black" : "white";
						var threat = true;
						if (destination.getAttribute('figuretype')!='nothing')
						{
							devoured.setAttribute('colorside', destination.getAttribute('colorside'));
							devoured.setAttribute('figuretype', destination.getAttribute('figuretype'));
							devoured.setAttribute('row', destination.getAttribute('row'));
							devoured.setAttribute('column', destination.getAttribute('column'));
							if (destination.hasAttribute("additional")) devoured.setAttribute('additional', destination.getAttribute('additional'));
							devoured.getElementsByTagName("img")[0].src=destination.getElementsByTagName("img")[0].src;
							move(touchedfigure, destination);
							if (!check(attackingcolor)) 
							{
								threat=false;			
							}
							move(destination, touchedfigure);
							destination.setAttribute('colorside', devoured.getAttribute('colorside'));
							destination.setAttribute('figuretype', devoured.getAttribute('figuretype'));
							destination.setAttribute('row', devoured.getAttribute('row'));
							destination.setAttribute('column', devoured.getAttribute('column'));
							if (devoured.hasAttribute("additional")) destination.setAttribute('additional', devoured.getAttribute('additional'));
							destination.appendChild(document.createElement("img"));
							destination.getElementsByTagName("img")[0].src=devoured.getElementsByTagName("img")[0].src;
						}
						else
						{				
							move(touchedfigure, destination);
							if (!check(attackingcolor)) 
							{
								threat=false;
							}
							move(destination, touchedfigure);
						}
						return threat;
					}
					
					function checkmate(defencingcolor)
					{
						var defenders = $(".cell[colorside=" + defencingcolor + "]");
						var attackingcolor = (defencingcolor === 'white'? 'black' : 'white');
						var threat = true;
						var defender;				
						defenders.each(function(){
							defender = this;
							$(".cell").each(function(){
								if (ismovecorrect(defender, this))
								{
									if (!isSimulatedMoveThreatening(defender, this)) 
									{
										threat = false;
										return;
									};
									/*if (this.getAttribute('figuretype')!='nothing')
									{
										devoured.setAttribute('colorside', this.getAttribute('colorside'));
										devoured.setAttribute('figuretype', this.getAttribute('figuretype'));
										devoured.setAttribute('row', this.getAttribute('row'));
										devoured.setAttribute('column', this.getAttribute('column'));
										devoured.getElementsByTagName("img")[0].src=this.getElementsByTagName("img")[0].src;
										move(defender, this);
										if (!check(attackingcolor)) 
										{
											threat=false;
											
										}
										move(this, defender);
										this.setAttribute('colorside', devoured.getAttribute('colorside'));
										this.setAttribute('figuretype', devoured.getAttribute('figuretype'));
										this.setAttribute('row', devoured.getAttribute('row'));
										this.setAttribute('column', devoured.getAttribute('column'));
										this.appendChild(document.createElement("img"));
										this.getElementsByTagName("img")[0].src=devoured.getElementsByTagName("img")[0].src;
										if (!threat) return;
									}
									else
									{				
										move(defender, this);
										if (!check(attackingcolor)) 
										{
											threat=false;
										}
										move(this, defender);
										if (!threat) return;
									}*/
								}			
							});

						});
						return threat;
					}
					
					var whichturn = 'white';
					var isfiguretouched = false;
					
					var touchedfigure = document.createElement("div");
					touchedfigure.appendChild(document.createElement("img"));
					
					
					insertimage('#dedede', "BlackRook.png", "rook", "black", "a", 8, 'not moving');
					insertimage('#bababa', "BlackKnight.png", "knight", "black", "b", 8, 'nothing');
					insertimage('#dedede', "BlackBishop.png", "bishop", "black", "c", 8, 'nothing');
					insertimage('#bababa', "BlackQueen.png", "queen", "black", "d", 8, 'nothing');
					insertimage('#dedede', "BlackKing.png", "king", "black", "e", 8, 'not moving');
					insertimage('#bababa', "BlackBishop.png", "bishop", "black", "f", 8, 'nothing');
					insertimage('#dedede', "BlackKnight.png", "knight", "black", "g", 8, 'nothing');
					insertimage('#bababa', "BlackRook.png", "rook", "black", "h", 8, 'not moving');
					
					for (var i=8; i<16; i++)
						insertimage((parseInt((i / 8) + i) % 2 == 0 ? '#dedede' : '#bababa'), 
						"BlackPawn.png", "pawn", "black", String.fromCharCode(89+i), 7, 'not moving');
									
					for (var i=16; i<48; i++)
						insertimage((parseInt((i / 8) + i) % 2 == 0 ? '#dedede' : '#bababa'), 
						null , "nothing", "nothing", String.fromCharCode(97+(i % 8)), 8 - (i - i % 8) / 8, 'nothing');
					
					for (var i=48; i<56; i++)
						insertimage((parseInt((i / 8) + i) % 2 == 0 ? '#dedede' : '#bababa'),
						"WhitePawn.png", "pawn", "white", String.fromCharCode(49+i), 2, 'not moving');
									
					insertimage("#bababa", "WhiteRook.png", "rook", "white", "a", 1, 'not moving');
					insertimage('#dedede', "WhiteKnight.png", "knight", "white", "b", 1, 'nothing');
					insertimage("#bababa", "WhiteBishop.png", "bishop", "white", "c", 1, 'nothing');
					insertimage('#dedede', "WhiteQueen.png", "queen", "white", "d", 1, 'nothing');
					insertimage("#bababa", "WhiteKing.png", "king", "white", "e", 1, 'not moving');
					insertimage('#dedede', "WhiteBishop.png", "bishop", "white", "f", 1, 'nothing');
					insertimage("#bababa", "WhiteKnight.png", "knight", "white", "g", 1, 'nothing');
					insertimage('#dedede', "WhiteRook.png", "rook", "white", "h", 1, 'not moving');

					$( ".cell" ).click(function(){
						if (!isfiguretouched || this.getAttribute('colorside') === whichturn)
						{
							if (this.getAttribute('figuretype')!='nothing' && this.getAttribute('colorside')===whichturn)
							{
								addToLogNewLine( 
									this.getAttribute('colorside') + ' ' +
									this.getAttribute('figuretype')+ ' ' +
									this.getAttribute('column')+
									this.getAttribute('row'));
								isfiguretouched = true;
								touchedfigure.setAttribute('colorside', this.getAttribute('colorside'));
								touchedfigure.setAttribute('figuretype', this.getAttribute('figuretype'));
								touchedfigure.setAttribute('row', this.getAttribute('row'));
								touchedfigure.setAttribute('column', this.getAttribute('column'));
								touchedfigure.getElementsByTagName("img")[0].src=this.getElementsByTagName("img")[0].src;
								if (this.hasAttribute('additional')) touchedfigure.setAttribute('additional', this.getAttribute('additional'));
							}
						}
						else
						{
							if (this.getAttribute('figuretype')==='nothing' || this.getAttribute('colorside')!=whichturn)
							{
								if (ismovecorrect(touchedfigure, this) && !isSimulatedMoveThreatening(touchedfigure, this))
								{
									addToLog( " - " + this.getAttribute('column') + this.getAttribute('row'));
									
									isfiguretouched = !isfiguretouched;
									move(touchedfigure, this);
									if (roquemode)
									{
										if (touchedfigure.getAttribute('column').charCodeAt(0) > this.getAttribute('column').charCodeAt(0))
										{ 
											move(finddiv('a', touchedfigure.getAttribute('row'))[0], finddiv('d', touchedfigure.getAttribute('row'))[0]);
										}
										else
										{
											move(finddiv('h', touchedfigure.getAttribute('row'))[0], finddiv('f', touchedfigure.getAttribute('row'))[0]);
										}
										roquemode=false;
									}
									if (check(whichturn)) 
									{
										addToLogNewLine('CHECK!');
										if (checkmate(whichturn==='white'? 'black' : 'white')) addToLogNewLine('MATE!');
									}
									whichturn = whichturn==='white'? 'black' : 'white';
								}
								else
								{
									addToLogNewLine("Incorrect move!");
									isfiguretouched = !isfiguretouched;
								}
							}
						}
					});
				</script>
		</body>
    </html>